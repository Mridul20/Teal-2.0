define ("mod_moodleoverflow/functions",["jquery","core/ajax","core/templates","core/notification","core/config","core/url","core/str"],function(a,b,c,d,e,f,g){var h={recordvote:function recordvote(g,h,i,j){var k=a(j.target).closest(".moodleoverflowpost").prev(),l=k.attr("id");l=l.substring(1);var m=b.call([{methodname:"mod_moodleoverflow_record_vote",args:{discussionid:g,postid:l,ratingid:h,sesskey:e.sesskey}}]);m[0].done(function(b){var d=a(j.target).parent().parent();if(2===h){d.children("a:first-of-type").children().attr("src",f.imageUrl("vote/upvoted","moodleoverflow"));d.children("a:nth-of-type(2)").children().attr("src",f.imageUrl("vote/downvote","moodleoverflow"))}else if(1===h){d.children("a:first-of-type").children().attr("src",f.imageUrl("vote/upvote","moodleoverflow"));d.children("a:nth-of-type(2)").children().attr("src",f.imageUrl("vote/downvoted","moodleoverflow"))}else{d.children("a:first-of-type").children().attr("src",f.imageUrl("vote/upvote","moodleoverflow"));d.children("a:nth-of-type(2)").children().attr("src",f.imageUrl("vote/downvote","moodleoverflow"))}d.children("p").text(b.postrating);c.replaceNode(a(".user-details,.author").find("a[href*=\"id="+i+"\"]").siblings("span"),"<span>"+b.raterreputation+"</span>","");if(b.ownerid&&i!==b.ownerid){c.replaceNode(a(".user-details,.author").find("a[href*=\"id="+b.ownerid+"\"]").siblings("span"),"<span>"+b.ownerreputation+"</span>","")}}).fail(d.exception);return m},clickevent:function clickevent(b,c){a(".upvote").on("click",function(d){if(a(d.target).is("a")){d.target=a(d.target).children()}if(0<=a(d.target).parent().attr("class").indexOf("active")){h.recordvote(b,20,c,d)}else{h.recordvote(b,2,c,d)}a(d.target).parent().toggleClass("active");a(d.target).parent().nextAll("a").removeClass("active")});a(".downvote").on("click",function(d){if(a(d.target).is("a")){d.target=a(d.target).children()}if(0<=a(d.target).parent().attr("class").indexOf("active")){h.recordvote(b,10,c,d)}else{h.recordvote(b,1,c,d)}a(d.target).parent().toggleClass("active");a(d.target).parent().prevAll("a").removeClass("active")});a(".marksolved").on("click",function(d){var e=a(d.target).parents(".moodleoverflowpost");if(e.hasClass("statusteacher")||e.hasClass("statusboth")){h.recordvote(b,30,c,d)[0].then(function(){h.removeSolvedFromPost(e)})}else{h.recordvote(b,3,c,d)[0].then(function(){h.removeOtherSolved(e.parent().parent());if(e.hasClass("statusstarter")){e.removeClass("statusstarter");e.addClass("statusboth")}else{e.addClass("statusteacher")}var b=g.get_string("marknotsolved","mod_moodleoverflow");a.when(b).done(function(b){a(d.target).text(b)});h.redoStatus(e)})}});a(".markhelpful").on("click",function(d){var e=a(d.target).parents(".moodleoverflowpost");if(e.hasClass("statusstarter")||e.hasClass("statusboth")){h.recordvote(b,40,c,d)[0].then(function(){h.removeHelpfulFromPost(e)})}else{h.recordvote(b,4,c,d)[0].then(function(){h.removeOtherHelpful(e.parent().parent());if(e.hasClass("statusteacher")){e.removeClass("statusteacher");e.addClass("statusboth")}else{e.addClass("statusstarter")}var b=g.get_string("marknothelpful","mod_moodleoverflow");a.when(b).done(function(b){a(d.target).text(b)});h.redoStatus(e)})}})},removeHelpfulFromPost:function removeHelpfulFromPost(b){if(b.hasClass("statusstarter")){b.removeClass("statusstarter")}else{b.removeClass("statusboth");b.addClass("statusteacher")}h.redoStatus(b);var c=g.get_string("markhelpful","mod_moodleoverflow");a.when(c).done(function(a){b.find(".markhelpful").text(a)})},removeOtherHelpful:function removeOtherHelpful(a){var b=a.find(".statusstarter, .statusboth");if(0<b.length){h.removeHelpfulFromPost(b)}},removeSolvedFromPost:function removeSolvedFromPost(b){if(b.hasClass("statusteacher")){b.removeClass("statusteacher")}else{b.removeClass("statusboth");b.addClass("statusstarter")}h.redoStatus(b);var c=g.get_string("marksolved","mod_moodleoverflow");a.when(c).done(function(a){b.find(".marksolved").text(a)})},removeOtherSolved:function removeOtherSolved(a){var b=a.find(".statusteacher, .statusboth");if(0<b.length){h.removeSolvedFromPost(b)}},redoStatus:function redoStatus(b){if(a(b).hasClass("statusboth")){g.get_strings([{key:"teacherrating",component:"mod_moodleoverflow"},{key:"starterrating",component:"mod_moodleoverflow"},{key:"bestanswer",component:"mod_moodleoverflow"}]).then(function(d){var e=c.renderPix("status/c_circle","mod_moodleoverflow",d[0]),f=c.renderPix("status/b_box","mod_moodleoverflow",d[1]);a.when(f,e).done(function(a,c){b.find(".status").html(a+c+d[2])});return d})}else if(a(b).hasClass("statusteacher")){g.get_strings([{key:"teacherrating",component:"mod_moodleoverflow"},{key:"solvedanswer",component:"mod_moodleoverflow"}]).then(function(d){var e=c.renderPix("status/c_outline","mod_moodleoverflow",d[0]);a.when(e).done(function(a){b.find(".status").html(a+d[1])});return d})}else if(a(b).hasClass("statusstarter")){g.get_strings([{key:"starterrating",component:"mod_moodleoverflow"},{key:"helpfulanswer",component:"mod_moodleoverflow"}]).then(function(d){var e=c.renderPix("status/b_outline","mod_moodleoverflow",d[0]);a.when(e).done(function(a){b.find(".status").html(a+d[1])});return d})}else{b.find(".status").html("")}}};return h});
//# sourceMappingURL=functions.min.js.map
