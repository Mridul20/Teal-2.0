{"version":3,"sources":["../src/functions.js"],"names":["define","$","ajax","templates","notification","Cfg","Url","str","t","recordvote","discussionid","ratingid","userid","event","target","closest","prev","postid","attr","substring","vote","call","methodname","args","sesskey","done","response","parentdiv","parent","children","imageUrl","text","postrating","replaceNode","find","siblings","raterreputation","ownerid","ownerreputation","fail","exception","clickevent","on","is","indexOf","toggleClass","nextAll","removeClass","prevAll","post","parents","hasClass","then","removeSolvedFromPost","removeOtherSolved","addClass","promiseStringNotSolved","get_string","when","string","redoStatus","removeHelpfulFromPost","removeOtherHelpful","promiseStringNotHelpful","promiseHelpful","root","formerhelpful","length","formersolution","get_strings","key","component","results","circle","renderPix","box","boxImg","circleImg","html"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Ajax functions for moodleoverflow\n *\n * @module     mod/moodleoverflow\n * @package    mod_moodleoverflow\n * @copyright  2017 Tamara Gunkel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/config', 'core/url', 'core/str'],\n    function($, ajax, templates, notification, Cfg, Url, str) {\n\n    var RATING_SOLVED = 3;\n    var RATING_REMOVE_SOLVED = 30;\n    var RATING_HELPFUL = 4;\n    var RATING_REMOVE_HELPFUL = 40;\n\n    var t = {\n\n        /**\n         * Reoords a upvote / downvote.\n         * @param {int} discussionid\n         * @param {int} ratingid\n         * @param {int} userid\n         * @param {event} event\n         * @returns {string}\n         */\n        recordvote: function(discussionid, ratingid, userid, event) {\n            var target = $(event.target).closest('.moodleoverflowpost').prev();\n            var postid = target.attr('id');\n            postid = postid.substring(1);\n\n            var vote = ajax.call([{\n                methodname: 'mod_moodleoverflow_record_vote',\n                args: {\n                    discussionid: discussionid,\n                    postid: postid,\n                    ratingid: ratingid,\n                    sesskey: Cfg.sesskey\n                }\n            }\n            ]);\n\n            vote[0].done(function(response) {\n\n                var parentdiv = $(event.target).parent().parent();\n                // Update Votes.\n                if (ratingid === 2) {\n                    parentdiv.children('a:first-of-type').children().attr(\n                        'src', Url.imageUrl('vote/upvoted', 'moodleoverflow'));\n                    parentdiv.children('a:nth-of-type(2)').children().attr(\n                        'src', Url.imageUrl('vote/downvote', 'moodleoverflow'));\n                } else if (ratingid === 1) {\n                    parentdiv.children('a:first-of-type').children().attr(\n                        'src', Url.imageUrl('vote/upvote', 'moodleoverflow'));\n                    parentdiv.children('a:nth-of-type(2)').children().attr(\n                        'src', Url.imageUrl('vote/downvoted', 'moodleoverflow'));\n                } else {\n                    parentdiv.children('a:first-of-type').children().attr(\n                        'src', Url.imageUrl('vote/upvote', 'moodleoverflow'));\n                    parentdiv.children('a:nth-of-type(2)').children().attr(\n                        'src', Url.imageUrl('vote/downvote', 'moodleoverflow'));\n                }\n\n                parentdiv.children('p').text(response.postrating);\n\n                // Update user reputation.\n                templates.replaceNode($('.user-details,.author').find('a[href*=\"id=' + userid + '\"]')\n                    .siblings('span'), '<span>' + response.raterreputation + '</span>', \"\");\n                if (response.ownerid && userid !== response.ownerid) {\n                    templates.replaceNode($('.user-details,.author').find('a[href*=\"id=' + response.ownerid + '\"]')\n                        .siblings('span'), '<span>' + response.ownerreputation + '</span>', \"\");\n                }\n            }).fail(notification.exception);\n\n            return vote;\n        },\n\n        /**\n         * Initializes the clickevent on upvotes / downvotes.\n         * @param {int} discussionid\n         * @param {int} userid\n         */\n        clickevent: function(discussionid, userid) {\n            $(\".upvote\").on(\"click\", function(event) {\n                if ($(event.target).is('a')) {\n                    event.target = $(event.target).children();\n                }\n\n                if ($(event.target).parent().attr('class').indexOf('active') >= 0) {\n                    t.recordvote(discussionid, 20, userid, event);\n                } else {\n                    t.recordvote(discussionid, 2, userid, event);\n                }\n                $(event.target).parent().toggleClass('active');\n                $(event.target).parent().nextAll('a').removeClass('active');\n            });\n\n            $(\".downvote\").on(\"click\", function(event) {\n                if ($(event.target).is('a')) {\n                    event.target = $(event.target).children();\n                }\n\n                if ($(event.target).parent().attr('class').indexOf('active') >= 0) {\n                    t.recordvote(discussionid, 10, userid, event);\n                } else {\n                    t.recordvote(discussionid, 1, userid, event);\n                }\n                $(event.target).parent().toggleClass('active');\n                $(event.target).parent().prevAll('a').removeClass('active');\n            });\n\n            $(\".marksolved\").on(\"click\", function(event) {\n                var post = $(event.target).parents('.moodleoverflowpost');\n\n                if (post.hasClass('statusteacher') || post.hasClass('statusboth')) {\n                    // Remove solution mark.\n                    t.recordvote(discussionid, RATING_REMOVE_SOLVED, userid, event)[0].then(function() {\n                        t.removeSolvedFromPost(post);\n                    });\n                } else {\n                    // Add solution mark.\n                    t.recordvote(discussionid, RATING_SOLVED, userid, event)[0].then(function() {\n                        // Remove other solution mark in dom.\n                        t.removeOtherSolved(post.parent().parent());\n                        if (post.hasClass('statusstarter')) {\n                            post.removeClass('statusstarter');\n                            post.addClass('statusboth');\n                        } else {\n                            post.addClass('statusteacher');\n                        }\n\n                        var promiseStringNotSolved = str.get_string('marknotsolved', 'mod_moodleoverflow');\n                        $.when(promiseStringNotSolved).done(function(string) {\n                            $(event.target).text(string);\n                        });\n\n                        t.redoStatus(post);\n                    });\n                }\n\n\n            });\n\n            $(\".markhelpful\").on(\"click\", function(event) {\n                var post = $(event.target).parents('.moodleoverflowpost');\n\n                if (post.hasClass('statusstarter') || post.hasClass('statusboth')) {\n                    // Remove helpful mark.\n                    t.recordvote(discussionid, RATING_REMOVE_HELPFUL, userid, event)[0].then(function() {\n                        t.removeHelpfulFromPost(post);\n                    });\n                } else {\n                    // Add helpful mark.\n                    t.recordvote(discussionid, RATING_HELPFUL, userid, event)[0].then(function() {\n                        // Remove other helpful mark in dom.\n                        t.removeOtherHelpful(post.parent().parent());\n                        if (post.hasClass('statusteacher')) {\n                            post.removeClass('statusteacher');\n                            post.addClass('statusboth');\n                        } else {\n                            post.addClass('statusstarter');\n                        }\n\n                        var promiseStringNotHelpful = str.get_string('marknothelpful', 'mod_moodleoverflow');\n                        $.when(promiseStringNotHelpful).done(function(string) {\n                            $(event.target).text(string);\n                        });\n                        t.redoStatus(post);\n                    });\n                }\n\n            });\n        },\n\n        removeHelpfulFromPost: function (post) {\n            if (post.hasClass('statusstarter')) {\n                post.removeClass('statusstarter');\n            } else {\n                post.removeClass('statusboth');\n                post.addClass('statusteacher');\n            }\n\n            t.redoStatus(post);\n\n            var promiseHelpful = str.get_string('markhelpful', 'mod_moodleoverflow');\n            $.when(promiseHelpful).done(function (string) {\n                post.find('.markhelpful').text(string);\n            });\n        },\n\n        removeOtherHelpful: function(root) {\n            var formerhelpful = root.find('.statusstarter, .statusboth');\n            if (formerhelpful.length > 0) {\n                t.removeHelpfulFromPost(formerhelpful);\n            }\n        },\n\n        removeSolvedFromPost: function(post) {\n            if (post.hasClass('statusteacher')) {\n                post.removeClass('statusteacher');\n            } else {\n                post.removeClass('statusboth');\n                post.addClass('statusstarter');\n            }\n\n            t.redoStatus(post);\n\n            var promiseHelpful = str.get_string('marksolved', 'mod_moodleoverflow');\n            $.when(promiseHelpful).done(function(string) {\n                post.find('.marksolved').text(string);\n            });\n        },\n\n        removeOtherSolved: function(root) {\n            var formersolution = root.find('.statusteacher, .statusboth');\n            if (formersolution.length > 0) {\n                t.removeSolvedFromPost(formersolution);\n            }\n        },\n\n        /**\n         * Redoes the post status\n         * @param {object} post dom with .moodleoverflowpost which status should be redone\n         */\n        redoStatus: function(post) {\n            if ($(post).hasClass('statusboth')) {\n                var statusBothRequest = [\n                    {key: 'teacherrating', component: 'mod_moodleoverflow'},\n                    {key: 'starterrating', component: 'mod_moodleoverflow'},\n                    {key: 'bestanswer', component: 'mod_moodleoverflow'}\n                ];\n                str.get_strings(statusBothRequest).then(function(results) {\n                    var circle = templates.renderPix('status/c_circle', 'mod_moodleoverflow', results[0]);\n                    var box = templates.renderPix('status/b_box', 'mod_moodleoverflow', results[1]);\n                    $.when(box, circle).done(function(boxImg, circleImg) {\n                        post.find('.status').html(boxImg + circleImg + results[2]);\n                    });\n                    return results;\n                });\n            } else if ($(post).hasClass('statusteacher')) {\n                var statusTeacherRequest = [\n                    {key: 'teacherrating', component: 'mod_moodleoverflow'},\n                    {key: 'solvedanswer', component: 'mod_moodleoverflow'}\n                ];\n                str.get_strings(statusTeacherRequest).then(function(results) {\n                    var circle = templates.renderPix('status/c_outline', 'mod_moodleoverflow', results[0]);\n                    $.when(circle).done(function(circleImg) {\n                        post.find('.status').html(circleImg + results[1]);\n                    });\n                    return results;\n                });\n            } else if ($(post).hasClass('statusstarter')) {\n                var statusStarterRequest = [\n                    {key: 'starterrating', component: 'mod_moodleoverflow'},\n                    {key: 'helpfulanswer', component: 'mod_moodleoverflow'}\n                ];\n                str.get_strings(statusStarterRequest).then(function(results) {\n                    var box = templates.renderPix('status/b_outline', 'mod_moodleoverflow', results[0]);\n                    $.when(box).done(function(boxImg) {\n                        post.find('.status').html(boxImg + results[1]);\n                    });\n                    return results;\n                });\n            } else {\n                post.find('.status').html('');\n            }\n\n        }\n    };\n\n    return t;\n});\n"],"file":"functions.min.js"}